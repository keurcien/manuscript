# Introduction 

## La génétique des populations

> "Il est bon de rappeler que ce qui nous rend semblables est plus important que ce qui nous rend différents. Les milliards d'êtres humains éparpillés sur toute la planète se différencient par la couleur de la peau et par la forme du corps, par la langue et par la culture. Et cette variété, qui témoigne de notre capacité à changer, à nous adapter à des milieux différents et à y développer des modes de vie originaux, est la meilleure garantie pour l'avenir de l'espèce humaine. Les connaissances que nous avons acquises sur nous-mêmes montrent cependant que toute cette diversité, comme la surface changeante des océans ou de la voûte du ciel, est bien peu de chose par rapport à cet immense patrimoine que nous avons en commun, nous, les humains."
>
> --- @cavalli1994francesco

### L'évolution comme point de départ

« La génétique est la science de l'hérédité. Elle est la clé de toute la biologie, parce qu'elle explique les mécanismes qui sont responsables de la reproduction des êtres vivants, du fonctionnement et de la transmission du matériel héréditaire, des différences entre les individus, de l'évolution biologique. » 

Cette définition, donnée par Cavalli-Sforza et traduite ici de l'italien par Françoise Brun [@cavalli1994francesco], restitue également les motivations à l'origine de l'émergence du domaine de la génétique des populations, à savoir l'étude de la variabilité interindividuelle d'un point de vue évolutionniste. Pour John H. Gillespie, il s'agit de la « discipline qui fait le lien entre la génétique et l'évolution » [@gillespie2010population] : « La génétique des populations s'intéresse à l'évolution d'un point de vue génétique. Elle diffère de la biologie en ce que ses idées les plus importantes ne sont pas expérimentales ou observationnelles mais davantage théoriques. Il pourrait difficilement en être autrement. Les objets d'étude sont principalement la fréquence et la valeur sélective des génotypes dans les populations naturelles. » 

Malgré cette caractérisation, les fondements de la génétique des populations trouvent en réalité leurs origines bien avant la formalisation en 1909 par Wilhelm Johannsen du concept même de gène [@roll2014holist], en témoignent les travaux de Charles Darwin (1809-1882) et de Gregor Mendel (1822-1884). *L'Origine des espèces*, publié en 1859 et considéré encore à ce jour comme le texte fondateur de la théorie de l'évolution [@darwin1980origine], énonce les premiers principes de la sélection naturelle. Les travaux de Mendel, figurent quant à eux parmi les premiers à se pencher sur les mécanismes de l'hérédité d'un point de vue statistique, notamment via l'étude de phénotypes en termes de proportions et de fréquences. 

```{r mendel, fig.cap="Représentation schématique des lois de Mendel."}
include_graphics("figure/mendel.png")
```

## À l'origine de la variabilité génétique

### La théorie de l'évolution

En 1859, Darwin soutenait l'idée selon laquelle la principale force évolutive serait la sélection naturelle [@darwin1980origine]. « Je me propose de passer brièvement en revue les progrès de l’opinion relativement à l’origine des espèces. Jusque tout récemment, la plupart des naturalistes croyaient que les espèces sont des productions immuables créées séparément. De nombreux savants ont habilement soutenu cette hypothèse. Quelques autres, au contraire, ont admis que les espèces éprouvent des modifications et que les formes actuelles descendent de formes préexistantes par voie de génération régulière. »

C'est de cette manière qu'en 1920, Edmond Barbier, dans sa notice relative à la traduction française de *L'Origine des espèces* [@darwin1980origine], décide de présenter le contexte dans lequel il a été amené à effectuer ce travail de traduction. Bien que la théorie de Darwin fut globalement bien accueillie par la communauté scientifique, elle fut tout de même en proie à de nombreuses critiques. L'une des principales critiques émises à son encontre fut relative à la croyance de Darwin selon laquelle l'hérédité *par mélange* serait le principal mode de transmission des caractères héréditaires [@gayon1992darwin]. Or, si sélection naturelle il y a, la conservation et la transmission des caractères sélectionnés sont essentielles. Si bien qu'une hérédité *par mélange* n'est pas envisageable pour soutenir la thèse de la sélection naturelle, puisque tout caractère transmis de cette façon se verrait altéré (ou dilué si l'on souhaite conserver l'idée de mélange) à chaque génération et donc éliminé après un certain temps. Cependant, sa théorie bénéficiera par la suite des travaux de Mendel qui, lors de leur redécouverte en 1902 [@bateson1913mendel], apporteront l'élément fondamental manquant à la théorie darwinienne : le principe d'hérédité *mendélienne*. Cette théorie de l'évolution néo-darwinienne, née de la conciliation de la théorie darwinienne et du principe d'hérédité de Mendel, constitue le paradigme évolutionniste tel que nous le connaissons aujourd'hui et porte le nom de *théorie synthétique de l'évolution*.

### L'évolution d'une théorie

À la théorie néo-darwinienne est souvent opposée la théorie neutraliste développée par Motoo Kimura dans son ouvrage *The neutral theory of molecular evolution* [@kimura1983neutral], bien que ces deux théories ne soient pas incompatibles. La première suggère que les mutations apparaissent à la faveur de la sélection naturelle. La seconde affirme quant à elle que l'évolution ne serait que le résultat de mutations qui surviennent de façon tout à fait aléatoire, tout en étant sélectionnées selon le même mécanisme de sélection naturelle proposé par Darwin. 

(ref:kimuravsdarwin-cap) Représentation schématique des probabilités d'occurrence pour chaque type de mutation pour la théorie sélectionniste de Darwin et pour la théorie neutraliste de Kimura [@bromham2003modern].

```{r kimuravsdarwin, fig.cap = '(ref:kimuravsdarwin-cap)', fig.height=3}
data.frame(theory = sort(rep(c("Darwin", "Kimura"), 3)),
           values = c(0.75, 0.0, 0.25, 0.5, 0.45, 0.05), 
           type = rep(c("Délétère", "Neutre", "Avantageuse"), 2)) %>%
  ggplot(aes(x = theory, 
             y = values, 
             fill = type)) + 
  coord_flip() +
  scale_fill_manual(name = "Mutation", 
                    values = cbbPalette[2:4]) +
  geom_bar(stat = "identity", 
           colour = "black", 
           width = 0.5) +
  theme_bw() +
  theme(axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())
```

Une des composantes principales de cette nouvelle théorie consiste à affirmer que les fluctuations aléatoires dans les fréquences d'allèle, n'affectant que très peu ou pas du tout la valeur sélective, constituent la principale source de variabilité de l'ADN [@charlesworth2009darwin]. Une grande partie de la variation génétique observée est fonctionnellement neutre et n'occasionne pas de changement de phénotype. 

L'approbation de cette théorie, bien que conceptuellement intéressante, aura un retentissement beaucoup plus important d'un point de vue méthodologie statistique. La formulation d'une hypothèse permettant de décrire un processus évolutif en l'absence de sélection, portant généralement le nom d'*hypothèse nulle* ou encore de *modèle neutre*, est souvent de première nécessité dans toute démarche visant à caractériser un mécanisme de sélection. La donnée d'observations mettant en défaut le modèle neutre aura pour conséquences de créditer davantage une hypothèse invoquant un processus de sélection. Historiquement, la statistique $D$ de Tajima fut l'une des premières statistiques développées à partir d'une hypothèse nulle bâtie pour les mutations neutres [@tajima1989statistical]. 

### Forces évolutives

Ce changement de paradigme nous invite de ce fait à observer la sélection naturelle à travers le prisme de la théorie neutraliste, et donc à identifier les mutations sélectives comme des mutations dont les origines ne peuvent être uniquement expliquées par des processus biologiquement neutres. La génétique des populations distingue trois types de processus neutres : la dérive génétique, les mutations aléatoires et le flux de gènes. Ces processus, tout comme la sélection naturelle, constituent les principales *forces évolutives*. 

> "La mutation propose, la sélection dispose."
>
> --- @cavalli1994francesco

#### La dérive génétique {-}

La dérive génétique correspond à tout ce qu'il y a d'aléatoire dans l'évolution d'une population. C'est le *hasard des choses*. Le nombre de descendants ou le choix de partenaire sexuel sont des exemples de phénomènes aléatoires participant à la dérive génétique. Le principe de dérive génétique est illustré en figure \@ref(fig:drift), à l'aide du modèle de Wright-Fisher tel qu'il est présenté dans l'ouvrage *Population Genetics* [@gillespie2010population]. Ce modèle simpliste suppose que la taille de la population est constante et que chaque individu de la ${n+1}^\text{ème}$ génération est issu du brassage génétique de deux individus tirés aléatoirement de la $n^\text{ème}$ génération.

(ref:drift-cap) Simulation numérique de la dérive génétique. La fréquence de l'allèle étudié est simulée pour 5 populations constituées chacune de 20, 100 ou 1000 individus sur une période de 100 générations. Dans chaque population, la fréquence de l'allèle est initialement de 0.20 [@gillespie2010population].

```{r drift, fig.height=7, fig.cap='(ref:drift-cap)'}
nb_generations <- 100
nb_populations <- 5
s <- c(20, 100, 1000)
p1 <- 0.2
init <- vector(mode = "numeric", 
               length = (nb_generations + 1) * nb_populations * length(s))
af.df <- data.frame(generation = init,
                    f.obs = init,
                    population = init,
                    size = sort(rep(s, (nb_generations + 1) * nb_populations)))

for (N in s) {
  for (k in 1:nb_populations) {
    x <- rep("A2", length = 2 * N)
    idx <- sample(1:(2 * N), size = floor(2 * N * p1)) 
    x[idx] <- "A1"
    offset <- (k - 1) * (nb_generations + 1)
    af.df[af.df$size == N, ]$generation[offset + 1] <- 0
    af.df[af.df$size == N, ]$f.obs[offset + 1] <- sum(x == "A1") / (2 * N)
    af.df[af.df$size == N, ]$population[offset + 1] <- k
    
    for (i in 1:nb_generations) {
      x <- sample(x, size = 2 * N, replace = TRUE)
      af.df[af.df$size == N, ]$generation[offset + i + 1] <- i
      af.df[af.df$size == N, ]$f.obs[offset + i + 1] <- sum(x == "A1") / (2 * N)
      af.df[af.df$size == N, ]$population[offset + i + 1] <- k
    }
  }
}

af.df %>% 
  ggplot(aes(x = generation, 
             y = f.obs, 
             color = as.factor(population))) +
  facet_wrap(~size, ncol = 1) +
  geom_line(size = 1.5) +
  scale_color_manual(values = cbbPalette[2:6]) +
  ylim(0, 1) +
  xlab("Génération") +
  ylab("Fréquence allélique") +
  theme_bw() +
  theme(legend.position = "none")
```

En particulier, la figure \@ref(fig:drift) met en évidence deux caractéristiques de la dérive génétique :

- Les fréquences alléliques évoluent de façon indépendante d'une population à une autre.

- Pour un nombre de générations fixé, la dérive génétique entraîne une perte de diversité allélique plus rapidement au sein des populations de plus petite taille. Dans le modèle de Wright-Fisher, les fréquences alléliques finissent éventuellement par atteindre les états dits absorbants que sont 0 et 1.

#### Les mutations aléatoires {-}

Si la dérive génétique entraîne une perte de diversité allélique, les mutations favorisent quant à elles le maintien des variations génétiques entre les populations [@gillespie2010population]. Les mutations apparaissent principalement lors de la phase de réplication de l'ADN. Une mutation peut survenir à un locus donné avec une probabilité spécifique à chaque espèce [@drake1998rates], appelée *taux de mutation*.

(ref:mutationRate-cap) Exemples de taux de mutation par paire de base et par réplication chez différentes espèces [@drake1998rates].

```{r mutationRate, results='asis', message=FALSE}
species <- c(paste("$E.$", "$coli$"), paste("$C.$", "$elegans$"), "Drosophile", "Souris", "Homme")
rates <- c("5.4e-10", "2.3e-10", "3.4e-10", "1.8e-10", "5.0e-11")
data.frame(Species = species, Rates = rates) %>%
  knitr::kable(col.names = c("Espèce", "Taux de mutation"),
               caption = '(ref:mutationRate-cap)',
               booktabs = TRUE,
               escape = FALSE) %>%
  kable_styling(full_width = T)
```


#### Le flux de gène {-}

Le flux de gène est généralement le résultat d'évènements migratoires (bien que ce ne soit pas nécessairement toujours le cas [@tigano2016genomics]), initiés par des individus appartenant à une population donnée, vers une seconde population dont le pool génique diffère éventuellement de la population d'origine. Le flux de gène influe sur la diversité génétique initialement présente si par exemple, parmi les allèles *migrants* figurent des allèles qui n'existaient pas dans la population receveuse.

#### La sélection naturelle {-}

En biologie évolutive, la sélection naturelle est la force évolutive qui tend à préserver les allèles conférant des avantages quant à la survie d'un individu ou d'une espèce. Elle agit sur les traits qui sont héritables. La grande majorité de ces traits sont transmis aux descendants en suivant le mécanisme d'hérédité génétique. Cependant, d'autres aspects de la biologie d'un organisme peuvent se transmettre via des mécanismes différents, comme certains comportements culturels ou caractéristiques de l'environnement qui ont été façonnées par les populations ancestrales [@gerbault2011evolution].

### Adaptation locale

#### Principe

La diversité climatique et la diversité géologique terrestre ont naturellement façonné des environnements aux constitutions physiques et chimiques variées. À celles-ci viennent s'ajouter des caractéristiques écologiques résultant des interactions entre l'environnement et les organismes qui y évoluent *lato sensu*. La valeur sélective, désignant la capacité de survie et de reproduction, de ces organismes peut être impactée par les caractéristiques environnementales auxquelles ils sont exposés. Si cette valeur sélective est associée à un trait phénotypique, on dit que ce trait confère un avantage adaptatif et on parle dans ce cas d'*adaptation locale*. Une population sera ainsi dite adaptée à son environnement si elle développe, par le biais de la sélection naturelle, un ou plusieurs allèles associés à un trait adaptatif augmentant la valeur sélective des individus la constituant, en réponse aux pressions environnementales auxquelles ces individus sont soumis. À titre d'exemple, nous pouvons citer l'adaptation des populations tibétaines et andines à la haute altitude [@beall2007two].

(ref:andeanvstibetan-cap) Exemples de phénotypes liés à l'adaptation à la haute altitude distinguant les populations andines des populations tibétaines [@jeong2014adaptations].

```{r andeanvstibetan, results='asis', message=FALSE}
tibetan <- c("à partir de 4000m d'altitude",
             "non",
             "non",
             "1%")
andean <- c("oui",
            "oui",
            "oui",
            "5%")
traits <- c("Augmentation du taux d'hémoglobine",
            "Augmentation de la pression artérielle pulmonaire",
            "Augmentation de la ventilation au repos",
            "Prévalence du mal chronique des montagnes")
data.frame(Traits = traits, Andean = andean, Tibetan = tibetan) %>%
  knitr::kable(col.names = c("Trait", "Andins", "Tibétains"),
               caption = '(ref:andeanvstibetan-cap)',
               booktabs = TRUE) %>%
  kable_styling(full_width = T)
```

Chez l'Homme moderne, les habitudes alimentaires et les modes de vie constituent également des caractéristiques environnementales importantes. L'agriculture et le pastoralisme^[Le pastoralisme décrit la relation interdépendante entre les éleveurs, leurs troupeaux et les milieux exploités.] ont notamment participé à la diversification des environnements humains [@jeong2014adaptations]. En Europe, l'adaptation biologique à ces nouveaux modes de vie s'est par ailleurs manifesté par la sélection du phénotype *LP*, dit de *persistence de la lactase*, caractérisant l'aptitude à digérer le lactose à l'âge adulte [@itan2009origins].

#### L'hybridation et le flux de gène comme sources d'adaptation

Un caractère peut être sélectionné au sein d'une population de différentes manières : 

- le caractère y est déjà présent^[standing genetic variation.].

- le caractère y apparaît à la suite d'une mutation spontanée^[*de novo* mutations.].

- le caractère est hérité d'une autre population par flux de gène^[adaptive introgression.].

Cette dernière possibilité est d'ailleurs très intéressante pour une espèce d'un point de vue de la diversité génétique. Pour enrichir le catalogue d'allèles, nous avons vu plus haut que le flux de gène constituait un processus clé. La reproduction sexuée est connue pour jouer un rôle important dans la sélection naturelle, offrant aux individus la possibilité, par le biais du brassage allélique, d'hériter des "meilleurs allèles" que possèdent leurs parents. Augmenter la diversité génétique augmente ainsi les chances de voir se transmettre des allèles favorables.

Nous parlons d'hybridation ou de métissage lorsque deux individus, appartenant à deux populations différentes, se reproduisent entre eux. Pour ce qui est de la distinction de populations, nous nous en tiendrons à la suggestion faite par @harrison1990hybrid, considérant que deux individus issus de populations différentes doivent chacun posséder des traits héritables qui les différencient. Ainsi, l'hybridation constitue un excellent moyen pour permettre à une espèce d'intégrer de nouveaux allèles [@stevison2008hybridization]. Bien que l'hybridation conduise fréquemment à la naissance d'individus à la valeur sélective hautement diminuée voire d'individus non fertiles, il arrive que certains descendants aient tout de même la capacité de se reproduire et ainsi être à l'origine de l'apparition de nouveaux allèles. La sélection de tels allèles transmis par flux de gène ou par hybridation correspond à ce que l'on appelle *l'introgression adaptative*. Des exemples d'introgression sont observés à la fois dans la nature (*introgression naturelle*) et à la fois chez des espèces domestiquées (*introgression délibérée*). Nous pouvons citer l'exemple de la souris domestique, *Mus musculus domesticus*, qui a hérité d'un gène de résistance à la coumadine (communément appelée « mort aux rats ») en s'hybridant avec une espèce sauvage, *Mus spretus* [@song2011adaptive]. Ce gène de résistance est localisé sur le chromosome 7 de la souris domestique et appartient à une région qui a été identifiée comme provenant effectivement de la souris sauvage.

------

L'identification des mutations génétiques responsables de l'adaptation est particulièrement cruciale pour la compréhension des processus évolutifs et plus spécifiquement ceux liés à la spéciation^[épisode de divergence d'une espèce ayant conduit à la formation d'au moins une nouvelle espèce.]. L'introgression adaptative permet quant à elle de comprendre l'adaptation rapide de certaines espèces et en quoi l'hybridation constitue un vecteur important pour l'adaptation [@hufford2013genomic]. Bien que l'étude de l'adaptation locale puisse être menée de façon expérimentale^[par le biais de la *transplantation réciproque* [@kawecki2004conceptual].], nous proposons ici d'exploiter les données de séquençage de génômes afin d'appréhender ce problème de façon plus quantitative.

## Données de polymorphismes génétiques

Avant d'aborder la partie sur les méthodes développées au cours de cette thèse, nous donnons une rapide présentation du type de données que nous traitons, à savoir des données de séquençage. Le séquençage de l'ADN consiste à déterminer l'ordre dans lequel sont agencées les paires de bases pour un fragment d'ADN donné. Son apparition a offert de nouvelles voies d'exploration en biologie évolutive. Les variations génétiques étaient jusqu'alors appréciées par le biais des différences phénotypiques. En phylogénie par exemple, le séquençage de l'ADN a donné naissance à la phylogénétique moléculaire, qui se distingue de la phylogénétique traditionnelle en ce qu'elle ne considère que les séquences de nucléotides pour évaluer la proximité entre deux espèces. Et c'est précisément l'accès à ces séquences qui va permettre à toute une population de méthodologies statistiques de voir le jour et de se développer.

### Des données en grande dimension

Le séquençage nouvelle génération (appelé encore séquençage à haut débit ou NGS) a connu un essor considérable au cours des dernières décennies. Si bien que les prouesses techniques et les progrès technologiques réalisés dans ce domaine ont permis de réduire d'un facteur 100,000 les coûts de séquençage en l'espace de seulement 15 ans (Figure \@ref(fig:wetterstrand)).

(ref:wetterstrand-cap) Évolution des coûts de séquençage depuis 2001 [@wetterstrand2013dna].

```{r wetterstrand, fig.cap='(ref:wetterstrand-cap)', fig.height=4}
df <- read.csv("data/seqcost2015_4.csv")
df %>%
  mutate(log10CpG = log10(Cost.per.Genome)) %>%
  ggplot(aes(x = as.Date(Date), y = log10CpG)) +
  geom_line(color = cbbPalette[6], size = 1.5) +
  scale_y_continuous(breaks = 1:8,
                     labels = c("10",
                                "100",
                                "1K",
                                "10K",
                                "100K",
                                "1M",
                                "10M",
                                "100M")) +
  xlab("Année") +
  ylab("Coût par génôme (en dollars)") +
  scale_x_date(date_minor_breaks = "1 year") +
  theme_bw()
```

Toutefois, compte tenu de la popularité croissante des technologies NGS [@muir2016real] et des considérables volumes de données qu'elles génèrent, de nouvelles problématiques se posent quant à leur stockage et leur analyse, nécessitant l'utilisation de puissantes ressources de calcul ainsi que le développement d'algorithmes plus adaptés [@gogol2012overview].

D'un point de vue statistique, l'accumulation de données, aussi bien en termes d'observations qu'en termes de variables, tend à opacifier la limite, si elle existe, entre ce qui relève du signal que l'on cherche à détecter, et ce qui n'en relève pas. Ce phénomène bien connu en statistiques porte le nom de *fléau de la dimension* [@giraud2014introduction].

### Les marqueurs génétiques

Le séquençage de l'ADN a également permis de faire évoluer le concept de *marqueur génétique*. Un marqueur génétique correspondait autrefois à un gène *polymorphe*^[présentant des variations à l'échelle de l'espèce.] identifié sur la base d'observations phénotypiques. Grâce au séquençage de l'ADN, une nouvelle définition tenant compte de la position sur le chromosome a été adoptée pour caractériser un marqueur génétique. Différents types de marqueurs génétiques ont été identifiés, parmi lesquels figurent les microsatellites, les insertions, les délétions et les SNPs^[SNP *(Single-Nucleotide Polymorphism)* : polymorphisme d'un seul nucléotide.]. La structure spatiale de l'ADN n'étant pas prise en compte dans les travaux présentés ici, nous en garderons une représentation unidimensionnelle.

#### Microsatellite {-}

Jusqu'à présent, les microsatellites ont connu un succès important, notamment grâce à la popularisation de techniques telles que la PCR (*Réaction en Chaîne par Polymérase*). Cependant, grâce aux nouvelles avancées technologiques que nous évoquerons un peu plus loin, ils sont progressivement délaissés au détriment des SNPs. Un microsatellite est repérable par la répétition successive de petits motifs chacun composé de 1 à 4 nucléotides.

(ref:microsat) Exemples de microsatellites. La première séquence comporte 3 répétitions du motif CCG, tandis que la seconde inclut 4 répétitions du motif CA.

```{r microsat, fig.cap = '(ref:microsat)', fig.height=3}
pair_base = function(seq) {
  x <- vector(mode = "character", length = length(seq))
  x[seq == "A"] <- "T"
  x[seq == "T"] <- "A"
  x[seq == "C"] <- "G"
  x[seq == "G"] <- "C"
  return(x)
}

N <- 20
nuclA1 <- sample(c("A", "C", "G", "T"), size = N, replace = TRUE)
nuclB1 <- sample(c("A", "C", "G", "T"), size = N, replace = TRUE)
idx.microsatA <- 3:11
idx.microsatB <- 10:17
nuclA1[idx.microsatA] <- c("C", "C", "G")
nuclB1[idx.microsatB] <- c("C", "A")
nuclA2 <- pair_base(nuclA1)
nuclB2 <- pair_base(nuclB1)

tA <- rep("DNA", 2 * N)
tB <- rep("DNA", 2 * N)
tA[c(idx.microsatA, idx.microsatA + N)] <- "X"
tB[c(idx.microsatB, idx.microsatB + N)] <- "X"

microsatA.df <- data.frame(x1 = rep(1:N, 2),
                           x2 = rep(2:(N + 1), 2),
                           y1 = c(rep(1, N), rep(3, N)),
                           y2 = c(rep(2, N), rep(4, N)),
                           t = tA,
                           r = c(nuclA1, nuclA2),
                           type = "3 répétitions du motif CCG")

microsatB.df <- data.frame(x1 = rep(1:N, 2),
                           x2 = rep(2:(N + 1), 2),
                           y1 = c(rep(1, N), rep(3, N)),
                           y2 = c(rep(2, N), rep(4, N)),
                           t = tB,
                           r = c(nuclB1, nuclB2),
                           type = "4 répétitions du motif CA")

rbind(microsatA.df, microsatB.df) %>%
  mutate(t = factor(t,
                    levels = c("DNA",
                               "X"),
                    ordered = TRUE)) %>%
  ggplot() +
  ggtitle("Microsatellite") +
  facet_wrap(~type, ncol = 1, scales = "free_x") +
  coord_fixed(ratio = 1) +
  scale_y_continuous(limits = c(-0.5, 5.5)) +
  scale_fill_manual(values = cbbPalette[c(3, 7)]) +
  geom_rect(mapping = aes(xmin = x1,
                          xmax = x2,
                          ymin = y1,
                          ymax = y2,
                          fill = t),
            color = "black",
            alpha = 0.75) +
  geom_text(aes(x = x1 + (x2 - x1) / 2,
                y = y1 + (y2 - y1) / 2,
                label = r),
            size = 4) +
  annotate("text",
           x = 3.25,
           y = 2.55,
           label = "paire de bases",
           size = 3,
           colour = "black") +
  geom_segment(aes(x = 1.5, y = 2, xend = 1.5, yend = 3),
               colour = "black",
               size = 0.3,
               arrow = arrow(length = unit(4, "pt"),
                             type = "closed",
                             ends = "both")) +
  theme_bw() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none",
        plot.title = element_text(hjust = 0.5))
```

#### Insertion/Délétion (Indel) {-}

L'insertion ou la délétion d'une base constituent également des polymorphismes génétiques. Relativement à une séquence de nucléotides de référence, une insertion consiste en la présence d'une base supplémentaire tandis que la délétion consiste en l'absence d'une base.

(ref:indel-cap) Exemple d'Indel.

```{r indel, fig.cap='(ref:indel-cap)', fig.height=3}
N <- 20
nuclA1 <- sample(c("A", "C", "G", "T"), size = N, replace = TRUE)
nuclA2 <- pair_base(nuclA1)
nuclB1 <- nuclA1
nuclB2 <- nuclA2
idx.SNP <- sample(1:N, size = 1)
nuclB1[idx.SNP] <- "-"
nuclB2[idx.SNP] <- "-"
tA <- rep("DNA1", 2 * N)
tB <- rep("DNA2", 2 * N)
tA[c(idx.SNP, idx.SNP + N)] <- "X"
tB[c(idx.SNP, idx.SNP + N)] <- "X"

indelA.df <- data.frame(x1 = rep(1:N, 2),
                        x2 = rep(2:(N + 1), 2),
                        y1 = c(rep(1, N), rep(3, N)),
                        y2 = c(rep(2, N), rep(4, N)),
                        t = tA,
                        r = c(nuclA1, nuclA2),
                        marker.type = "Indel")

indelB.df <- data.frame(x1 = rep(1:N, 2),
                        x2 = rep(2:(N + 1), 2),
                        y1 = c(rep(7, N), rep(9, N)),
                        y2 = c(rep(8, N), rep(10, N)),
                        t = tB,
                        r = c(nuclB1, nuclB2),
                        marker.type = "Indel")

rbind(indelA.df, indelB.df) %>%
  mutate(t = factor(t,
                    levels = c("DNA1",
                               "DNA2",
                               "X"),
                    ordered = TRUE)) %>%
  ggplot() +
  ggtitle("Insertion/Délétion") +
  coord_fixed() +
  scale_fill_manual(values = cbbPalette[c(3, 6, 7)]) +
  geom_rect(mapping = aes(xmin = x1,
                          xmax = x2,
                          ymin = y1,
                          ymax = y2,
                          fill = t),
            color = "black",
            alpha = 0.75) +
  geom_text(aes(x = x1 + (x2 - x1) / 2,
                y = y1 + (y2 - y1) / 2,
                label = r),
            size = 4) +
  annotate("text",
           x = 3.25,
           y = 8.55,
           label = "paire de bases",
           size = 3,
           colour = "black") +
  geom_segment(aes(x = 1.5, y = 8, xend = 1.5, yend = 9),
               colour = "black",
               size = 0.3,
               arrow = arrow(length = unit(4, "pt"),
                             type = "closed",
                             ends = "both")) +
  annotate("text",
           x = 3.25,
           y = 2.55,
           label = "paire de bases",
           size = 3,
           colour = "black") +
  geom_segment(aes(x = 1.5, y = 2, xend = 1.5, yend = 3),
               colour = "black",
               size = 0.3,
               arrow = arrow(length = unit(4, "pt"),
                             type = "closed",
                             ends = "both")) +
  theme_bw() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none",
        plot.title = element_text(hjust = 0.5))
```

#### Polymorphisme d'un seul nucléotide (SNP) {-}

Le polymorphisme d'un seul nucléotide correspond au polymorphisme génétique le plus simple, et correspond à l'emplacement d'un nucléotide présentant des variations appréciables à l'échelle d'une population. 

(ref:snp-cap) Exemple de SNP. 

```{r snp, fig.cap='(ref:snp-cap)', fig.height=3}
N <- 20
nuclA1 <- sample(c("A", "C", "G", "T"), size = N, replace = TRUE)
nuclA2 <- pair_base(nuclA1)
nuclB1 <- nuclA1
idx.SNP <- sample(1:N, size = 1)
if (nuclA1[idx.SNP] == "A" || nuclA1[idx.SNP] == "T") {
  nuclB1[idx.SNP] <- sample(c("C", "G"), size = 1)
} else if (nuclA1[idx.SNP] == "C" || nuclA1[idx.SNP] == "G") {
  nuclB1[idx.SNP] <- sample(c("A", "T"), size = 1)
}
nuclB2 <- pair_base(nuclB1)

tA <- rep("DNA1", 2 * N)
tB <- rep("DNA2", 2 * N)
tA[c(idx.SNP, idx.SNP + N)] <- "X"
tB[c(idx.SNP, idx.SNP + N)] <- "X"

SNPA.df <- data.frame(x1 = rep(1:N, 2),
                      x2 = rep(2:(N + 1), 2),
                      y1 = c(rep(1, N), rep(3, N)),
                      y2 = c(rep(2, N), rep(4, N)),
                      t = tA,
                      r = c(nuclA1, nuclA2),
                      marker.type = "SNP")

SNPB.df <- data.frame(x1 = rep(1:N, 2),
                      x2 = rep(2:(N + 1), 2),
                      y1 = c(rep(7, N), rep(9, N)),
                      y2 = c(rep(8, N), rep(10, N)),
                      t = tB,
                      r = c(nuclB1, nuclB2),
                      marker.type = "SNP")

rbind(SNPA.df, SNPB.df) %>%
  mutate(t = factor(t,
                    levels = c("DNA1",
                               "DNA2",
                               "X"),
                    ordered = TRUE)) %>%
  ggplot() +
  ggtitle("Polymorphisme d'un seul nucléotide") +
  coord_fixed() +
  scale_fill_manual(values = cbbPalette[c(3, 6, 7)]) +
  geom_rect(mapping = aes(xmin = x1,
                          xmax = x2,
                          ymin = y1,
                          ymax = y2,
                          fill = t),
            color = "black",
            alpha = 0.75) +
  geom_text(aes(x = x1 + (x2 - x1) / 2,
                y = y1 + (y2 - y1) / 2,
                label = r),
            size = 4) +
  annotate("text",
           x = 3.25,
           y = 8.55,
           label = "paire de bases",
           size = 3,
           colour = "black") +
  geom_segment(aes(x = 1.5, y = 8, xend = 1.5, yend = 9),
               colour = "black",
               size = 0.3,
               arrow = arrow(length = unit(4, "pt"),
                             type = "closed",
                             ends = "both")) +
  annotate("text",
           x = 3.25,
           y = 2.55,
           label = "paire de bases",
           size = 3,
           colour = "black") +
  geom_segment(aes(x = 1.5, y = 2, xend = 1.5, yend = 3),
               colour = "black",
               size = 0.3,
               arrow = arrow(length = unit(4, "pt"),
                             type = "closed",
                             ends = "both")) +
  theme_bw() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none",
        plot.title = element_text(hjust = 0.5))
```

### Encodage des données génétiques

Dans ce paragraphe nous présentons le format des données sur lesquelles nous travaillons et définissons quelques notations qui seront utilisées par la suite. Conformément à l'usage qui en est fait par @gillespie2010population, nous emploierons le terme d'allèle pour désigner la version d'une base nucléique à un locus donné. Dans le cadre de nos travaux, nous considèrerons que pour un locus donné, il n'existe que deux nucléotides possibles (SNP bi-allélique),
dont l'un sera considéré comme *l'allèle de référence* et l'autre comme *l'allèle alternatif*. Pour un locus donné, l'encodage des données de SNPs consiste à attribuer à chaque individu (Figure \@ref(fig:snp-encoding)) :

- la valeur $0$  s'il est homozygote pour l'allèle de référence.

- la valeur $1$  s'il est hétérozygote.

- la valeur $2$  s'il est homozygote pour l'allèle alternatif.

Une base de données de génômes constituée de séquences de nucléotides pourra donc en pratique être encodée par une matrice, appelée *matrice de génotypes*, composée uniquement de $0$, $1$ et $2$.

(ref:snp-encoding-cap) Exemple d'encodage de données de SNPs. **A**. Chaque ligne de la matrice correspond à un SNP et chaque individu est représenté par une paire de colonnes (de la même couleur). **B**. Matrice de génotypes résultant de l'encodage. **C**. Chaque ligne de la matrice correspond à un SNP. La première colonne indique quel allèle est considéré comme allèle de référence. La seconde colonne indique quel allèle est considéré comme allèle alternatif.

```{r snp-encoding, fig.cap='(ref:snp-encoding-cap)', fig.height=3}
N <- 6
SNP.lab <- c("A", "T", "A", "A", "A", "A",
             "C", "C", "C", "A", "A", "A",
             "G", "T", "T", "G", "G", "G")
SNP.x <- rep(1:6, 3)
SNP.y <- c(rep(1, 6), rep(2, 6), rep(3, 6))

geno.lab <- c("1", "0", "0",
              "0", "1", "2",
              "1", "1", "0")
geno.x <- rep(1:3, 3)
geno.y <- c(rep(1, 3), rep(2, 3), rep(3, 3))

ind <- rep(as.character(c(1, 1, 2, 2, 3, 3)), 3)

SNP.df <- data.frame(x1 = SNP.x,
                     x2 = SNP.x + 1,
                     y1 = SNP.y,
                     y2 = SNP.y + 1,
                     lab = SNP.lab,
                     ind = ind)

geno.df <- data.frame(x1 = geno.x,
                      x2 = geno.x + 1,
                      y1 = geno.y,
                      y2 = geno.y + 1,
                      lab = geno.lab,
                      ind = rep(as.character(1:3), 3))

BIM.df <- data.frame(x1 = c(1, 2, 1, 2, 1, 2),
                     x2 = c(1, 2, 1, 2, 1, 2) + 1,
                     y1 = c(1, 1, 2, 2, 3, 3),
                     y2 = c(1, 1, 2, 2, 3, 3) + 1,
                     lab = c("A", "T", "C", "A", "G", "T"),
                     ind = rep(c("4", "5"), 3),
                     data = "bim")

p1 <- SNP.df %>% 
  ggplot() +
  coord_fixed() +
  geom_rect(mapping = aes(xmin = x1,
                          xmax = x2,
                          ymin = y1,
                          ymax = y2,
                          fill = ind),
            color = "black",
            alpha = 0.75) +
  geom_text(aes(x = x1 + (x2 - x1) / 2,
                y = y1 + (y2 - y1) / 2,
                label = lab),
            size = 5) +
  scale_fill_manual(values = cbbPalette[c(3, 6, 7)]) +
  xlab("Individus") +
  ylab("SNPs") +
  theme_bw() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none",
        plot.title = element_text(hjust = 0.5))

p2 <- geno.df %>% 
  ggplot() +
  coord_fixed() +
  geom_rect(mapping = aes(xmin = x1,
                          xmax = x2,
                          ymin = y1,
                          ymax = y2,
                          fill = ind),
            color = "black",
            alpha = 0.75) +
  geom_text(aes(x = x1 + (x2 - x1) / 2,
                y = y1 + (y2 - y1) / 2,
                label = lab),
            size = 5) +
  scale_fill_manual(values = cbbPalette[c(3, 6, 7)]) +
  xlab("Individus") +
  ylab("SNPs") +
  theme_bw() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none",
        plot.title = element_text(hjust = 0.5))

p3 <- BIM.df %>% 
  ggplot() +
  coord_fixed() +
  scale_fill_manual(name = "Allèle",
                    labels = c("Référence", "Alternatif"),
                    values = c("#E69F00", "#009E73")) +
  geom_rect(mapping = aes(xmin = x1,
                          xmax = x2,
                          ymin = y1,
                          ymax = y2,
                          fill = ind),
            color = "black",
            alpha = 0.75) +
  geom_text(aes(x = x1 + (x2 - x1) / 2,
                y = y1 + (y2 - y1) / 2,
                label = lab),
            size = 5) +
  theme_bw() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5))  


plot_grid(p1, p2, p3, labels = c("A", "B", "C"))
```

Dans la mesure du possible, l'allèle de référence (resp. alternatif) est choisi de façon à correspondre à l'allèle ancestral (resp. dérivé). En pratique, le choix de l'allèle de référence et de l'allèle alternatif peut se faire de façon totalement arbitraire sans que cela n'influe sur les méthodes statistiques basées sur la variance des allèles, ce qui sera généralement le cas pour celles qui sont présentées ici. 

Les matrices de génotypes seront généralement notées $G$ et seront considérées comme des éléments de $M_{pn}(\{0,1,2\})$, où $p$ désigne le nombre de locus et $n$ le nombre d'individus. Ainsi, $G_{.,i}$ désignera le vecteur de taille $p$ composé des génotypes de l'individu $i$. De même, $G_{j,.}$ désignera le vecteur de taille $n$ contenant le génotype des individus pour le locus $j$. À la matrice $G$ sera associée la matrice $\tilde{G}$, normalisée pour les lignes (c'est-à-dire pour les SNPs). Notant $f_j$ la fréquence allélique de l'allèle alternatif (ou de l'allèle de référence), nous définissons $\tilde{G}_{j,.}$ par :

\begin{equation}
  \tilde{G}_{j,.} = \frac{G_{j,.} - 2f_j}{\sqrt{2f_j(1-f_j)}}
\end{equation}

Le choix de cette normalisation sera discuté plus tard.

## Les motivations de la thèse

La production de données génétiques, volumineuses par la quantité d'information qu'elles renferment, laisse présager le meilleur pour les domaines de la médecine clinique et de la biologie évolutive. En génétique des populations, leur acquisition offre de nombreuses perspectives d'étude, notamment concernant la mise en évidence de gènes impliqués dans les processus évolutifs ou de gènes associés à certains phénotypes. Les méthodes répondant à cette problématique portent le nom de *scans génomiques*. Les scans génomiques pour la sélection, destinés à isoler des locus sous sélection, se sont largement répandus au cours des dernières années, principalement grâce au développement fulgurant qu'ont connu les technologies NGS. Pour illustrer le principe des scans génomiques, nous reprenons l'exemple des Tibétains dont l'adaptation locale à la haute altitude est suspectée d'avoir été rendue possible grâce à l'introgression de gènes hérités de l'Homme de Denisova [@hu2017evolutionary]. Pour détecter les gènes responsables de cette adaptation, @xu2010genome ont réalisé un scan génomique en analysant la différenciation génétique entre une population constituée de tibétains et une autre constituée de Hans. Le résultat de ce scan génomique^[se présente généralement sous la forme d'un graphique, appelé *Manhattan plot*, représentant la statistique de test utilisée en fonction de l'emplacement chromosomique.] est présenté en figure \@ref(fig:tibetan-scan). 

(ref:tibetan-scan-cap) Scan génomique utilisant la $F_{ST}$ (mesure de différenciation génétique de référence) que nous introduirons dans le chapitre suivant. Deux régions génomiques présentant des valeurs de $F_{ST}$ significativement élevées ont été identifiées sur les chromosomes 1 et 2 [@xu2010genome].

```{r tibetan-scan, results='asis', fig.cap='(ref:tibetan-scan-cap)'}
include_graphics("figure/tibetan_fst.png")
```

(ref:tibetan-introgression-cap) Scan génomique pour l'introgression utilisant la statistique $D$ ($D^{*}$ correspond à la normalisation de la statistique $D$ que nous introduirons dans le chapitre [A COMPLETER]) [@hu2017evolutionary].

```{r tibetan-introgression, results='asis', message=FALSE}
Chr <- c(7, 2, 2, 5, 12, 4)
start <- c(26800001, 46400001, 47600001, 200001, 8800001, 100400001)
end <- c(27000000, 46600000, 47800000, 400000, 9000000, 100600000)
D <- c(6.25, 6.15, 5.92, 4.99, 4.63, 4.58)
Genes <- c("SKAP2", "PRKCE, EPAS1", "MIR559, MSH2, EPCAM, KCNK12", "CCDC127, PDCD6, SDHA", "MFAP5, RIMKLB, A2ML1", "TRMT10A, C4orf17, MTTP")
data.frame(Chr = Chr,
           start = start,
           end = end,
           D = D,
           Genes = Genes) %>%
  knitr::kable(col.names = c("Chr",
                             "start",
                             "end",
                             "$D^{*}$",
                             "Genes in the regions"),
               caption = '(ref:tibetan-introgression-cap)',
               booktabs = TRUE,
               escape = FALSE) %>%
  kable_styling(full_width = T)
```


Principalement réalisés sur des données humaines, les scans génomiques se sont progressivement étendus à d'autres espèces, modèles et non-modèles [@haasl2016detecting], tout en amorçant la transition vers des marqueurs génétiques de type SNP (Figure \@ref(fig:gwss)).

(ref:gwss-cap) Évolution de la proportion d'articles scientifiques s'intéressant à des espèces non humaines et de la proportion de ceux dont l'étude est réalisée sur des données de SNPs, dans le cadre des scans génomiques pour la sélection [@haasl2016detecting].

```{r gwss, fig.cap = '(ref:gwss-cap)', fig.height=3}
df <- read.csv2("data/NIHMS785639-supplement-Supplemental_Table_1.csv") %>%
  mutate(Recent = (Year >= 2010))
snp <- strsplit(as.character(df$Markers), split = " ")
df$Methodology <- as.character(df$Methodology)
df$Methodology[108] <- "recombination, and LD"
df$Methodology[128] <- "extreme Tajima's D; searching for balancing selection"
df$Methodology <- as.factor(df$Methodology)
fst_6 <- strsplit(as.character(df$Methodology), split = "-")
fst_space <- strsplit(as.character(df$Methodology), split = " ")
df$var <- unlist(lapply(snp, FUN = function(x){("SNP" %in% x) || ("SNPs" %in% x)}))

snp.df <- df %>%
  group_by(Recent, var) %>%
  summarise(count = n()) %>%
  mutate(freq = count / sum(count)) %>%
  filter(var)

snp.df$data <- "SNP"

word.list <- c("Homo sapiens",
               "Homo sapiens and Pan troglodytes",
               "Homo sapiens, Pan troglodytes",
               "Homo sapiens, Pan troglodytes, Mus musculus",
               "Homo sapiens, Pan troglodytes, oragutan, Rhesus macaque")

h.df <- df %>% mutate(var = Species %in% word.list) %>%
  group_by(Recent, var) %>%
  summarise(count = n()) %>%
  mutate(freq = count / sum(count)) %>%
  filter(!var)

h.df$data <- "Human"

bool_6 <- unlist(lapply(fst_6, FUN = function(x){"FST" %in% x}))
bool_space <- unlist(lapply(fst_space, FUN = function(x){"FST" %in% x}))
df$var <- (bool_6 | bool_space)

fst.df <- df %>%
  group_by(Recent, var) %>%
  summarise(count = n()) %>%
  mutate(freq = count / sum(count)) %>%
  filter(var)

fst.df$data <- "FST"

df <- rbind(snp.df, h.df, fst.df)
df$Recent[df$Recent] <- "2010-2016"
df$Recent[df$Recent == FALSE] <- "1999-2009"
df$Recent <- factor(df$Recent, levels = sort(unique(df$Recent), decreasing = TRUE))

df %>% ggplot(aes(x = Recent,
                  y = freq,
                  fill = factor(data))) +
  ylim(0, 1) +
  coord_flip() +
  geom_bar(stat = "identity",
           colour = "black",
           position = "dodge",
           width = 0.5) +
  scale_fill_manual(labels = c("Proportion de scans à sélection utilisant l'indice de fixation",
                               "Proportion de scans à sélection pour des espèces non humaines",
                               "Proportion de scans à sélection utilisant des données de SNPs"),
                    values = cbbPalette[c(8, 6, 5)]) +
  theme_bw() +
  theme(axis.ticks.y = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.direction = "vertical")
```

Toutefois, certains outils statistiques ayant été développés ne sont plus adaptés. La raison principale étant que les temps de calculs requis par ces outils pour l'analyse de données massives sont souvent prohibitifs. Les méthodes d'analyse exploratoire nécessitent souvent d'être expérimentées plusieurs fois. D'une part parce que le prétraitement des données peut être est amené à changer au cours de l'étude (filtration de marqueurs génétiques présentant une proportion trop élevée de données manquantes, retrait d'individus marginaux, etc.). D'autre part car les méthodes d'analyse proposent généralement un éventail de paramètres dont le choix ne s'impose pas spontanément. Expérimenter une même méthode avec différents critères de qualité et différents paramètres est souvent nécessaire pour minimiser les biais d'utilisation. Tout ceci justifie le recours à des méthodes rapides et adaptées à ces nouveaux volumes de données. Pour satisfaire à ces critères, des méthodes basées sur l'Analyse en Composantes Principales ont été proposées pour étudier l'adaptation locale [@duforet2015detecting; @galinsky2016fast]. 

Sur la base du travail de thèse de Nicolas Duforet-Frebourg [@duforet2014statistiques], nous avons cherché dans un premier temps à améliorer la méthodologie statistique implémentée dans le logiciel PCAdapt, ainsi que les performances computationnelles, afin de garantir la possibilité de l'utiliser sur des génômes plus denses et disposant d'une plus grande résolution.

Dans un premier temps, nous définirons les différents modèles, historiques et contemporains, utilisés pour réaliser des scans génomiques pour la sélection. Ce premier chapitre sera conclu par l'emploi de l'Analyse en Composantes Principales en génétique des populations. Les chapitres suivants seront consacrées aux approches statistiques basées sur l'ACP qui ont été implémentées dans le package R que nous avons développé au cours de cette thèse. Ils illustreront comment l'ACP peut être exploitée de façon à détecter des signaux de sélection ainsi que des régions d'introgression adaptative. Enfin, nous terminerons avec les aspects computationnels et numériques qui nous ont préoccupé tout au long de la thèse, en présentant quelques comparatifs de performances réalisées avec divers algorithmes.


